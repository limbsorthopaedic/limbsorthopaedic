<!-- Sticky Header/Nav for LIMBS Orthopaedic -->
<header class="sticky-top">
    <!-- Announcement Bar (optional) -->
    <div class="bg-primary-dark text-white py-2 text-center text-sm">
        <div class="container mx-auto px-4">
            <p>Call us at <a href="tel:+254719628276" class="font-bold hover:underline">+254 719 628 276</a>, <a href="tel:+254714663594" class="font-bold hover:underline">+254 714 663 594</a>, or <a href="tel:+254705347657" class="font-bold hover:underline">+254 705 347 657 (Office)</a> for appointments and inquiries</p>
        </div>
    </div>

    <!-- Main Navigation -->
    <nav class="navbar-sticky bg-white py-3 shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <!-- Logo and Brand -->
                <a href="{% url 'home' %}" class="flex items-center">
                    <img src="https://i.imgur.com/V6XTdBi.jpg" alt="LIMBS Orthopaedic Logo" class="h-12 w-auto mr-3 rounded-md">
                    <span class="text-lg md:text-xl font-bold hidden md:block" style="color: #34bdf2;">LIMBS<span style="color: #1e266f;">Orthopaedic</span></span>
                </a>

                <!-- Search Bar - Mobile (between logo and hamburger) -->
                <div class="md:hidden flex-1 max-w-xs mx-4 relative">
                    <div class="relative w-full">
                        <form action="{% url 'search_results' %}" method="GET" class="w-full">
                            <input type="text" 
                                   id="mobile-search-input"
                                   name="q"
                                   placeholder="Search services or products..." 
                                   class="w-full px-3 py-2 pr-10 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" 
                                   autocomplete="off">
                            <button type="submit" 
                                    id="mobile-search-button" 
                                    class="absolute right-1 top-1/2 transform -translate-y-1/2 p-1.5 text-primary hover:text-primary-dark">
                                <i class="fas fa-search text-xs"></i>
                            </button>
                        </form>

                        <!-- Mobile Search Suggestions Dropdown -->
                        <div id="mobile-search-suggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg mt-1 z-50 hidden max-h-80 overflow-y-auto">
                            <!-- Suggestions will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Search Bar - Desktop -->
                <div class="hidden md:flex max-w-68 mx-4 relative">
                    <div class="relative w-full">
                        <form action="{% url 'search_results' %}" method="GET" class="flex w-full">
                            <div class="relative flex-1">
                                <input type="text" 
                                       id="search-input"
                                       name="q"
                                       placeholder="Search services or products..." 
                                       class="w-full px-3 py-1.5 pl-8 pr-3 text-sm border border-gray-300 rounded-l-full focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" 
                                       autocomplete="off">
                                <i class="fas fa-search absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs"></i>
                            </div>
                            <button type="submit" 
                                    id="search-button" 
                                    class="px-3 py-0.5 bg-primary text-white rounded-r-full hover:bg-primary-dark transition-colors flex-shrink-0">
                                <i class="fas fa-search text-sm"></i>
                            </button>
                        </form>

                        <!-- Search Suggestions Dropdown -->
                        <div id="search-suggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg mt-1 z-50 hidden max-h-96 overflow-y-auto">
                            <!-- Suggestions will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-3 items-center">
                    <a href="{% url 'home' %}" class="nav-link font-medium hover:text-primary transition-colors {% if request.path == '/' %}text-primary{% endif %}">Home</a>
                    <a href="{% url 'about' %}" class="nav-link font-medium hover:text-primary transition-colors {% if '/about/' in request.path %}text-primary{% endif %}">About</a>
                    <a href="{% url 'services' %}" class="nav-link font-medium hover:text-primary transition-colors {% if '/services/' in request.path %}text-primary{% endif %}">Services</a>
                    <a href="{% url 'products' %}" class="nav-link font-medium hover:text-primary transition-colors {% if '/products/' in request.path %}text-primary{% endif %}">Products</a>
                    <a href="{% url 'gallery:gallery' %}" class="nav-link font-medium hover:text-primary transition-colors {% if '/gallery/' in request.path %}text-primary{% endif %}">Gallery</a>
                    <a href="{% url 'contact' %}" class="nav-link font-medium hover:text-primary transition-colors {% if '/contact/' in request.path %}text-primary{% endif %}">Contact</a>
                    <a href="{% url 'testimonials' %}" class="nav-link font-medium hover:text-primary transition-colors {% if '/testimonials/' in request.path %}text-primary{% endif %}">Testimonials</a>
                    <a href="{% url 'appointment' %}" class="btn btn-primary py-2 px-4 rounded-md text-white hover:bg-primary-dark transition-colors ml-3">Appointment</a>

                    <!-- Cart Icon -->
                    <a href="{% url 'cart_view' %}" class="relative inline-flex items-center p-2 text-gray-700 hover:text-primary transition-colors ml-2">
                        <i class="fas fa-shopping-cart text-lg"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold" style="display: none;">0</span>
                    </a>

                    <!-- User account menu -->
                    {% if user.is_authenticated %}
                    <div class="user-dropdown relative">
                        <button class="user-dropdown-toggle flex items-center text-gray-700 hover:text-primary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 rounded px-2 py-1 transition-colors">
                            <span class="mr-1 text-sm">{{ user.username }}</span>
                            <i class="fas fa-chevron-down text-xs transition-transform duration-200"></i>
                        </button>
                        <div class="user-dropdown-menu w-48 bg-white rounded-md shadow-lg py-1 border border-gray-200" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 0.25rem; z-index: 50;">
                            {% if user.doctor %}
                            <a href="{% url 'doctor_dashboard' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Doctor Dashboard</a>
                            <a href="{% url 'doctor_profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Doctor Profile</a>
                            {% else %}
                            <a href="{% url 'profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Your Profile</a>
                            {% endif %}

                            {% if user.is_staff %}
                            <a href="/admin/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Admin Panel</a>
                            <a href="/adminlimbsorth/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Alternative Admin</a>
                            {% endif %}

                            {% if user.is_superuser or user.doctor %}
                            <a href="{% url 'staff_chat:staff_chat' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-comments mr-1"></i> Staff Chat
                            </a>
                            {% endif %}
                            <hr class="my-1">
                            <form id="logout-form" action="{% url 'logout' %}" method="post" class="m-0">
                                {% csrf_token %}
                                <button type="submit" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</button>
                            </form>
                        </div>
                    </div>
                    {% else %}
                    <a href="{% url 'login' %}" class="nav-link font-medium hover:text-primary transition-colors">Login</a>
                    {% endif %}
                </div>

                <!-- Mobile Menu Button -->
                <button class="md:hidden mobile-menu-toggle focus:outline-none" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars text-2xl text-gray-700"></i>
                </button>
            </div>

            <!-- Mobile Navigation Menu -->
            <div class="mobile-menu md:hidden mt-4 pb-2 hidden">
                <a href="{% url 'home' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if request.path == '/' %}text-primary font-bold{% endif %}">Home</a>
                <a href="{% url 'about' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/about/' in request.path %}text-primary font-bold{% endif %}">About</a>
                <a href="{% url 'services' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/services/' in request.path %}text-primary font-bold{% endif %}">Services</a>
                <a href="{% url 'products' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/products/' in request.path %}text-primary font-bold{% endif %}">Products</a>
                <a href="{% url 'gallery:gallery' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/gallery/' in request.path %}text-primary font-bold{% endif %}">Gallery</a>
                <a href="{% url 'blog' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/blog/' in request.path %}text-primary font-bold{% endif %}">Blog</a>
                <a href="{% url 'contact' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/contact/' in request.path %}text-primary font-bold{% endif %}">Contact</a>
                <a href="{% url 'testimonials' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 {% if '/testimonials/' in request.path %}text-primary font-bold{% endif %}">Testimonials</a>
                <a href="{% url 'appointment' %}" class="block py-2 px-4 text-sm font-bold text-white bg-primary hover:bg-primary-dark my-2">Book an Appointment</a>
                
                <!-- Mobile Cart -->
                <a href="{% url 'cart_view' %}" class="block py-2 px-4 text-sm hover:bg-gray-100 flex items-center justify-between">
                    <span>Shopping Cart</span>
                    <span id="mobile-cart-count" class="bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold" style="display: none;">0</span>
                </a>

                {% if user.is_authenticated %}
                <hr class="my-2">
                {% if user.doctor %}
                <a href="{% url 'doctor_dashboard' %}" class="block py-2 px-4 text-sm hover:bg-gray-100">Doctor Dashboard</a>
                <a href="{% url 'doctor_profile' %}" class="block py-2 px-4 text-sm hover:bg-gray-100">Doctor Profile</a>
                {% else %}
                <a href="{% url 'profile' %}" class="block py-2 px-4 text-sm hover:bg-gray-100">Your Profile</a>
                {% endif %}

                {% if user.is_staff %}
                <a href="/admin/" class="block py-2 px-4 text-sm hover:bg-gray-100">Admin Panel</a>
                <a href="/adminlimbsorth/" class="block py-2 px-4 text-sm hover:bg-gray-100">Alternative Admin</a>
                {% endif %}

                {% if user.is_superuser or user.doctor %}
                <a href="{% url 'staff_chat:staff_chat' %}" class="block py-2 px-4 text-sm hover:bg-gray-100">
                    <i class="fas fa-comments mr-1"></i> Staff Chat
                </a>
                {% endif %}
                <form action="{% url 'logout' %}" method="post" class="m-0">
                    {% csrf_token %}
                    <button type="submit" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100">Logout</button>
                </form>
                {% else %}
                <hr class="my-2">
                <a href="{% url 'login' %}" class="block py-2 px-4 text-sm hover:bg-gray-100">Login</a>
                <a href="{% url 'register' %}" class="block py-2 px-4 text-sm hover:bg-gray-100">Register</a>
                {% endif %}
            </div>
        </div>
    </nav>
</header>