
{% load i18n %}

<div class="form-section">
  {% if fieldset.name %}
    <h2>{{ fieldset.name }}</h2>
  {% endif %}

  {% if fieldset.description %}
    <div class="description" style="padding: 1rem 2rem; background: rgba(52, 189, 242, 0.05); color: #1565c0; font-style: italic; border-left: 4px solid var(--primary);">
      {{ fieldset.description|safe }}
    </div>
  {% endif %}

  {% for line in fieldset %}
    <div class="form-row{% if line.fields|length_is:'1' and line.errors %} errors{% endif %}{% if not line.has_visible_field %} hidden{% endif %}{% for field in line %} field-{{ field.field.name }}{% endfor %}">
      {% if line.fields|length_is:'1' %}
        {% for field in line %}
          <div>
            {% if field.field.label %}
              <label{% if field.field.widget.attrs.id %} for="{{ field.field.widget.attrs.id }}"{% endif %}>
                {{ field.field.label }}
                {% if field.field.required %}
                  <span style="color: #f44336; margin-left: 0.25rem;">*</span>
                {% endif %}
              </label>
            {% endif %}
            
            {% if field.is_readonly %}
              <div class="readonly" style="padding: 0.75rem 1rem; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 8px; color: #6c757d;">
                {{ field.contents }}
              </div>
            {% else %}
              {{ field.field }}
            {% endif %}
            
            {% if field.field.help_text %}
              <div class="helptext">{{ field.field.help_text|safe }}</div>
            {% endif %}
            
            {% for error in field.field.errors %}
              <ul class="errorlist">
                <li>{{ error }}</li>
              </ul>
            {% endfor %}
          </div>
        {% endfor %}
      {% else %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
          {% for field in line %}
            <div>
              {% if field.field.label %}
                <label{% if field.field.widget.attrs.id %} for="{{ field.field.widget.attrs.id }}"{% endif %}>
                  {{ field.field.label }}
                  {% if field.field.required %}
                    <span style="color: #f44336; margin-left: 0.25rem;">*</span>
                  {% endif %}
                </label>
              {% endif %}
              
              {% if field.is_readonly %}
                <div class="readonly" style="padding: 0.75rem 1rem; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 8px; color: #6c757d;">
                  {{ field.contents }}
                </div>
              {% else %}
                {{ field.field }}
              {% endif %}
              
              {% if field.field.help_text %}
                <div class="helptext">{{ field.field.help_text|safe }}</div>
              {% endif %}
              
              {% for error in field.field.errors %}
                <ul class="errorlist">
                  <li>{{ error }}</li>
                </ul>
              {% endfor %}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% endfor %}
</div>
