
{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}
{% if add %}{% blocktranslate with name=opts.verbose_name %}Add {{ name }}{% endblocktranslate %}{% else %}{% blocktranslate with name=opts.verbose_name %}Change {{ name }}{% endblocktranslate %}{% endif %} | {{ site_title|default:_('LIMBS Orthopaedic Admin') }}
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
/* Material Dashboard Change Form Styling */
.change-form-container {
  padding: 2rem;
  background: linear-gradient(135deg, #fefefe 0%, #f5f7fa 100%);
  min-height: 100vh;
  font-family: 'Roboto', sans-serif;
}

.form-header {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  padding: 2rem;
  border-radius: 16px;
  margin-bottom: 2rem;
  box-shadow: 0 10px 25px rgba(52, 189, 242, 0.3);
  position: relative;
  overflow: hidden;
}

.form-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #4caf50, #2196f3, #ff9800, #f44336);
}

.form-header h1 {
  margin: 0;
  font-size: 2rem;
  font-weight: 300;
  display: flex;
  align-items: center;
}

.form-header .material-icons {
  font-size: 2.5rem;
  margin-right: 1rem;
  opacity: 0.9;
}

.form-subtitle {
  opacity: 0.9;
  font-size: 1rem;
  margin-top: 0.5rem;
}

/* Form Container */
.form-content {
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  border: 1px solid rgba(52, 189, 242, 0.1);
  margin-bottom: 2rem;
}

.form-content-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1.5rem 2rem;
  border-bottom: 2px solid #34bdf2;
}

.form-content-title {
  margin: 0;
  color: #1e266f;
  font-size: 1.25rem;
  font-weight: 500;
  display: flex;
  align-items: center;
}

.form-content-title .material-icons {
  margin-right: 0.75rem;
  color: #34bdf2;
}

.form-body {
  padding: 2rem;
}

/* Fieldsets */
.module {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  margin-bottom: 2rem;
  overflow: hidden;
  border: 1px solid #e9ecef;
}

.module h2 {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  margin: 0;
  padding: 1rem 1.5rem;
  font-size: 1.1rem;
  font-weight: 500;
  display: flex;
  align-items: center;
}

.module h2 .material-icons {
  margin-right: 0.75rem;
  font-size: 1.3rem;
}

.module .form-row {
  padding: 1.5rem;
  border-bottom: 1px solid #f1f3f4;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.module .form-row:last-child {
  border-bottom: none;
}

.module .form-row.errors {
  background: rgba(244, 67, 54, 0.05);
  border-left: 4px solid #f44336;
}

/* Labels */
label {
  font-weight: 500;
  color: #1e266f;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  margin-bottom: 0.5rem;
}

label .material-icons {
  margin-right: 0.5rem;
  font-size: 1.1rem;
  color: #34bdf2;
}

label.required::after {
  content: ' *';
  color: #f44336;
  font-weight: bold;
}

/* Form Controls */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="number"],
input[type="url"],
input[type="tel"],
input[type="date"],
input[type="datetime-local"],
input[type="time"],
textarea,
select {
  width: 100%;
  padding: 0.875rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 0.9rem;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background: #f8f9fa;
  outline: none;
  box-sizing: border-box;
  font-family: 'Roboto', sans-serif;
}

input[type="text"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
input[type="number"]:focus,
input[type="url"]:focus,
input[type="tel"]:focus,
input[type="date"]:focus,
input[type="datetime-local"]:focus,
input[type="time"]:focus,
textarea:focus,
select:focus {
  border-color: #34bdf2;
  background: white;
  box-shadow: 0 0 0 3px rgba(52, 189, 242, 0.1);
  transform: translateY(-1px);
}

textarea {
  min-height: 120px;
  resize: vertical;
}

select {
  cursor: pointer;
}

/* Checkboxes and Radio Buttons */
input[type="checkbox"],
input[type="radio"] {
  width: auto;
  margin-right: 0.5rem;
  transform: scale(1.2);
  accent-color: #34bdf2;
}

/* File Inputs */
input[type="file"] {
  padding: 0.75rem;
  border: 2px dashed #e0e0e0;
  border-radius: 8px;
  background: #f8f9fa;
  transition: all 0.3s ease;
  cursor: pointer;
}

input[type="file"]:hover {
  border-color: #34bdf2;
  background: rgba(52, 189, 242, 0.05);
}

/* Error Messages */
.errorlist {
  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
  color: white;
  border-radius: 8px;
  padding: 0.75rem 1rem;
  margin: 0.5rem 0;
  list-style: none;
  font-size: 0.9rem;
  box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
}

.errorlist li {
  display: flex;
  align-items: center;
}

.errorlist li::before {
  content: 'error';
  font-family: 'Material Icons';
  margin-right: 0.5rem;
  font-size: 1rem;
}

/* Help Text */
.help {
  color: #6c757d;
  font-size: 0.85rem;
  margin-top: 0.5rem;
  display: flex;
  align-items: center;
}

.help::before {
  content: 'info';
  font-family: 'Material Icons';
  margin-right: 0.5rem;
  font-size: 1rem;
  color: #34bdf2;
}

/* Submit Buttons */
.submit-row {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(52, 189, 242, 0.1);
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  align-items: center;
}

.submit-row input[type="submit"],
.submit-row button,
.submit-row .button {
  padding: 0.875rem 2rem;
  border-radius: 25px;
  font-weight: 500;
  font-size: 0.95rem;
  text-decoration: none;
  border: none;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  min-width: 120px;
}

.submit-row input[type="submit"]::before,
.submit-row button::before,
.submit-row .button::before {
  font-family: 'Material Icons';
  margin-right: 0.5rem;
  font-size: 1.1rem;
}

.default,
.submit-row input[type="submit"]:not(.cancel-link):not(.deletelink) {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(52, 189, 242, 0.3);
}

.default::before {
  content: 'save';
}

.default:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(52, 189, 242, 0.4);
}

.cancel-link {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
}

.cancel-link::before {
  content: 'cancel';
}

.cancel-link:hover {
  background: linear-gradient(135deg, #495057 0%, #343a40 100%);
  transform: translateY(-2px);
  color: white;
  text-decoration: none;
}

.deletelink {
  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
  color: white;
}

.deletelink::before {
  content: 'delete';
}

.deletelink:hover {
  background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);
  transform: translateY(-2px);
  color: white;
  text-decoration: none;
}

/* Inline Forms */
.inline-group {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  margin-bottom: 2rem;
  overflow: hidden;
  border: 1px solid #e9ecef;
}

.inline-group .module h2 {
  background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
}

.inline-related {
  border-bottom: 1px solid #e9ecef;
  padding: 1.5rem;
}

.inline-related:last-child {
  border-bottom: none;
}

.add-row {
  background: rgba(76, 175, 80, 0.1);
  padding: 1rem 1.5rem;
  border-top: 1px solid #e9ecef;
}

.add-row a {
  color: #4caf50;
  text-decoration: none;
  font-weight: 500;
  display: flex;
  align-items: center;
}

.add-row a::before {
  content: 'add_circle';
  font-family: 'Material Icons';
  margin-right: 0.5rem;
}

.add-row a:hover {
  color: #388e3c;
}

/* Related Widget Wrapper */
.related-widget-wrapper {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.related-widget-wrapper select {
  flex: 1;
}

.related-widget-wrapper a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: #34bdf2;
  color: white;
  border-radius: 6px;
  text-decoration: none;
  transition: all 0.3s ease;
}

.related-widget-wrapper a:hover {
  background: #1e266f;
  transform: scale(1.1);
}

/* Calendar Widget */
.calendarbox {
  background: white;
  border: 2px solid #34bdf2;
  border-radius: 12px;
  box-shadow: 0 8px 25px rgba(52, 189, 242, 0.3);
}

.calendar table {
  width: 100%;
}

.calendar th {
  background: #34bdf2;
  color: white;
  padding: 0.75rem;
  text-align: center;
}

.calendar td {
  padding: 0.5rem;
  text-align: center;
  border: 1px solid #e9ecef;
}

.calendar td a {
  display: block;
  padding: 0.5rem;
  color: #1e266f;
  text-decoration: none;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.calendar td a:hover {
  background: #34bdf2;
  color: white;
}

/* CKEditor Styling */
.django-ckeditor-widget {
  border-radius: 8px;
  overflow: hidden;
  border: 2px solid #e0e0e0;
  transition: border-color 0.3s ease;
}

.django-ckeditor-widget:focus-within {
  border-color: #34bdf2;
  box-shadow: 0 0 0 3px rgba(52, 189, 242, 0.1);
}

/* Responsive Design */
@media (max-width: 768px) {
  .change-form-container {
    padding: 1rem;
  }
  
  .form-header {
    padding: 1.5rem;
  }
  
  .form-header h1 {
    font-size: 1.5rem;
  }
  
  .form-body {
    padding: 1rem;
  }
  
  .module .form-row {
    padding: 1rem;
  }
  
  .submit-row {
    padding: 1.5rem;
    flex-direction: column;
  }
  
  .submit-row input,
  .submit-row button,
  .submit-row .button {
    width: 100%;
  }
}

/* Loading States */
.loading {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(52, 189, 242, 0.3);
  border-radius: 50%;
  border-top-color: #34bdf2;
  animation: spin 1s ease-in-out infinite;
  margin-left: 0.5rem;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Focus animations */
@keyframes focusRing {
  0% {
    box-shadow: 0 0 0 0 rgba(52, 189, 242, 0.4);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(52, 189, 242, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(52, 189, 242, 0);
  }
}

input:focus,
textarea:focus,
select:focus {
  animation: focusRing 0.6s ease-out;
}
</style>
{{ media }}
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
  &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
  &rsaquo; {% if has_view_permission %}<a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %}
  &rsaquo; {% if add %}{% blocktranslate with name=opts.verbose_name %}Add {{ name }}{% endblocktranslate %}{% else %}{{ original|truncatewords:"18" }}{% endif %}
</div>
{% endblock %}

{% block content %}
<div class="change-form-container">
  <!-- Form Header -->
  <div class="form-header">
    <h1>
      {% if add %}
        <span class="material-icons">add_circle</span>
        {% blocktranslate with name=opts.verbose_name %}Add {{ name }}{% endblocktranslate %}
      {% else %}
        <span class="material-icons">edit</span>
        {% blocktranslate with name=opts.verbose_name %}Change {{ name }}{% endblocktranslate %}
      {% endif %}
    </h1>
    <p class="form-subtitle">
      {% if add %}
        Create a new {{ opts.verbose_name|lower }} entry
      {% else %}
        Modify existing {{ opts.verbose_name|lower }}: {{ original|truncatewords:"10" }}
      {% endif %}
    </p>
  </div>

  <div id="content-main">
    {% block object-tools %}
      {% if change and not is_popup %}
        <div class="object-tools">
          {% block object-tools-items %}
            {% change_form_object_tools %}
          {% endblock %}
        </div>
      {% endif %}
    {% endblock %}

    <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}method="post"{% if form_url %} action="{{ form_url }}"{% endif %} novalidate>
      {% csrf_token %}
      
      {% block form_top %}{% endblock %}
      
      <div class="form-content">
        <div class="form-content-header">
          <h2 class="form-content-title">
            <span class="material-icons">assignment</span>
            {{ opts.verbose_name|capfirst }} Details
          </h2>
        </div>
        
        <div class="form-body">
          {% if errors %}
            <div class="errorlist">
              <li>{% if errors|length == 1 %}{% translate "Please correct the error below." %}{% else %}{% translate "Please correct the errors below." %}{% endif %}</li>
            </div>
          {% endif %}
          
          {% block field_sets %}
            {% for fieldset in adminform %}
              {% include "admin/includes/fieldset.html" %}
            {% endfor %}
          {% endblock %}
          
          {% block after_field_sets %}{% endblock %}
          
          {% block inline_field_sets %}
            {% for inline_admin_formset in inline_admin_formsets %}
              {% include inline_admin_formset.opts.template %}
            {% endfor %}
          {% endblock %}
          
          {% block after_related_objects %}{% endblock %}
        </div>
      </div>
      
      {% block submit_buttons_bottom %}
        <div class="submit-row">
          {% block submit_buttons %}
            {% if show_save %}<input type="submit" value="{% translate 'Save' %}" class="default" name="_save">{% endif %}
            {% if show_delete_link %}
              <p class="deletelink-box">
                <a href="{% url opts|admin_urlname:'delete' original.pk|admin_urlquote %}" class="deletelink">
                  {% translate "Delete" %}
                </a>
              </p>
            {% endif %}
            {% if show_save_as_new %}<input type="submit" value="{% translate 'Save as new' %}" name="_saveasnew">{% endif %}
            {% if show_save_and_add_another %}<input type="submit" value="{% translate 'Save and add another' %}" name="_addanother">{% endif %}
            {% if show_save_and_continue %}<input type="submit" value="{% translate 'Save and continue editing' %}" name="_continue">{% endif %}
            {% if show_close %}<a href="{% url opts|admin_urlname:'changelist' %}" class="button cancel-link">{% translate 'Close' %}</a>{% endif %}
          {% endblock %}
        </div>
      {% endblock %}
      
      {% block admin_change_form_document_ready %}
        <script id="django-admin-form-add-constants"
                src="{% static 'admin/js/change_form.js' %}"
                {% if adminform and add %}
                  data-model-name="{{ opts.model_name }}"
                {% endif %}
                async>
        </script>
      {% endblock %}
      
      {# JavaScript for prepopulated fields #}
      {% prepopulated_fields_js %}
    </form>
  </div>
</div>

<script>
// Add loading states and enhancements
document.addEventListener('DOMContentLoaded', function() {
  // Add loading state to submit buttons
  const submitButtons = document.querySelectorAll('input[type="submit"], button[type="submit"]');
  submitButtons.forEach(button => {
    button.addEventListener('click', function() {
      if (this.form.checkValidity()) {
        this.innerHTML += '<span class="loading"></span>';
        this.disabled = true;
      }
    });
  });
  
  // Enhanced file input styling
  const fileInputs = document.querySelectorAll('input[type="file"]');
  fileInputs.forEach(input => {
    input.addEventListener('change', function() {
      if (this.files.length > 0) {
        this.style.borderColor = '#4caf50';
        this.style.background = 'rgba(76, 175, 80, 0.05)';
      }
    });
  });
  
  // Auto-resize textareas
  const textareas = document.querySelectorAll('textarea');
  textareas.forEach(textarea => {
    textarea.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = this.scrollHeight + 'px';
    });
  });
});
</script>
{% endblock %}
