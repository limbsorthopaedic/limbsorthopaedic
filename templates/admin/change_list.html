
{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('LIMBS Orthopaedic Admin') }}{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
/* Material Dashboard Change List Styling */
.change-list-container {
  background: linear-gradient(135deg, #fefefe 0%, #f5f7fa 100%);
  min-height: calc(100vh - 120px);
  padding: 2rem;
  font-family: 'Roboto', sans-serif;
}

.change-list-header {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  padding: 2rem;
  border-radius: 16px;
  margin-bottom: 2rem;
  box-shadow: 0 10px 25px rgba(52, 189, 242, 0.3);
  position: relative;
  overflow: hidden;
}

.change-list-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #4caf50, #2196f3, #ff9800, #f44336);
}

.change-list-header h1 {
  margin: 0;
  font-size: 2rem;
  font-weight: 300;
  display: flex;
  align-items: center;
}

.change-list-header .material-icons {
  font-size: 2.5rem;
  margin-right: 1rem;
  opacity: 0.9;
}

.change-list-subtitle {
  margin-top: 0.5rem;
  opacity: 0.9;
  font-size: 1.1rem;
  font-weight: 400;
}

/* Actions and Filters */
.actions-container {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(52, 189, 242, 0.1);
}

.actions {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.actions select {
  padding: 0.75rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  background: white;
  font-size: 0.9rem;
  min-width: 200px;
  transition: all 0.3s ease;
}

.actions select:focus {
  border-color: #34bdf2;
  outline: none;
  box-shadow: 0 0 0 3px rgba(52, 189, 242, 0.1);
}

.action-button {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 25px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  font-size: 0.9rem;
}

.action-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(52, 189, 242, 0.4);
}

.action-button .material-icons {
  margin-right: 0.5rem;
  font-size: 1.2rem;
}

/* Add Button */
.add-link-container {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  text-align: center;
  border: 1px solid rgba(52, 189, 242, 0.1);
}

.addlink {
  background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
  color: white;
  text-decoration: none;
  padding: 1rem 2rem;
  border-radius: 25px;
  font-weight: 500;
  font-size: 1rem;
  display: inline-flex;
  align-items: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
  position: relative;
  overflow: hidden;
}

.addlink::before {
  content: 'add_circle';
  font-family: 'Material Icons';
  margin-right: 0.75rem;
  font-size: 1.5rem;
}

.addlink:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
  text-decoration: none;
  color: white;
}

/* Search and Filters */
.search-filters-container {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(52, 189, 242, 0.1);
}

.search-form {
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
}

.search-form input[type="text"] {
  flex: 1;
  padding: 0.75rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 25px;
  font-size: 0.9rem;
  min-width: 250px;
  transition: all 0.3s ease;
  background: #f8f9fa;
}

.search-form input[type="text"]:focus {
  border-color: #34bdf2;
  background: white;
  outline: none;
  box-shadow: 0 0 0 3px rgba(52, 189, 242, 0.1);
}

.search-submit {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 25px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
}

.search-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(52, 189, 242, 0.3);
}

.search-submit::before {
  content: 'search';
  font-family: 'Material Icons';
  margin-right: 0.5rem;
  font-size: 1.2rem;
}

/* Results Table */
.results-container {
  background: white;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  border: 1px solid rgba(52, 189, 242, 0.1);
}

.results-header {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  padding: 1.5rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.results-title {
  font-size: 1.25rem;
  font-weight: 500;
  margin: 0;
  display: flex;
  align-items: center;
}

.results-title .material-icons {
  margin-right: 0.75rem;
  font-size: 1.5rem;
}

.results-count {
  background: rgba(255,255,255,0.2);
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
}

#result_list {
  width: 100%;
  border-collapse: collapse;
  background: white;
  margin: 0;
}

#result_list thead th {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1rem 1.5rem;
  text-align: left;
  font-weight: 600;
  color: #1e266f;
  border-bottom: 2px solid #34bdf2;
  font-size: 0.9rem;
  position: relative;
}

#result_list thead th a {
  color: #1e266f;
  text-decoration: none;
  font-weight: 600;
  display: flex;
  align-items: center;
}

#result_list thead th a:hover {
  color: #34bdf2;
}

#result_list thead th.sorted {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
}

#result_list thead th.sorted a {
  color: white;
}

#result_list tbody td {
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #e9ecef;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  vertical-align: middle;
}

#result_list tbody tr {
  transition: all 0.3s ease;
}

#result_list tbody tr:hover {
  background: rgba(52, 189, 242, 0.05);
  transform: translateY(-1px);
}

#result_list tbody tr:hover td {
  background: transparent;
}

/* Action Checkboxes */
.action-checkbox {
  width: 18px;
  height: 18px;
  border: 2px solid #34bdf2;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.action-checkbox:checked {
  background: #34bdf2;
}

/* Links in table */
#result_list a {
  color: #1e266f;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.3s ease;
}

#result_list a:hover {
  color: #34bdf2;
  text-decoration: underline;
}

/* Status badges */
.status-badge {
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: inline-block;
}

.status-active {
  background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
  color: white;
}

.status-inactive {
  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
  color: white;
}

.status-pending {
  background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
  color: white;
}

.status-draft {
  background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
  color: white;
}

/* Pagination */
.pagination {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-top: 1.5rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  text-align: center;
  border: 1px solid rgba(52, 189, 242, 0.1);
}

.pagination .this-page {
  background: linear-gradient(135deg, #34bdf2 0%, #1e266f 100%);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  margin: 0 0.25rem;
  font-weight: 500;
}

.pagination a {
  color: #1e266f;
  text-decoration: none;
  padding: 0.5rem 1rem;
  margin: 0 0.25rem;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-weight: 500;
}

.pagination a:hover {
  background: rgba(52, 189, 242, 0.1);
  color: #34bdf2;
}

/* Empty state */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: #6c757d;
}

.empty-state .material-icons {
  font-size: 5rem;
  color: #e0e0e0;
  margin-bottom: 1rem;
}

.empty-state h3 {
  margin: 0 0 1rem 0;
  color: #6c757d;
  font-size: 1.5rem;
}

.empty-state p {
  margin: 0;
  font-size: 1rem;
}

/* Responsive Design */
@media (max-width: 1200px) {
  .change-list-container {
    padding: 1.5rem;
  }
}

@media (max-width: 768px) {
  .change-list-container {
    padding: 1rem;
  }
  
  .change-list-header {
    padding: 1.5rem;
  }
  
  .change-list-header h1 {
    font-size: 1.5rem;
  }
  
  .search-form {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-form input[type="text"] {
    min-width: auto;
    margin-bottom: 1rem;
  }
  
  .actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .actions select {
    margin-bottom: 1rem;
  }
  
  #result_list {
    font-size: 0.8rem;
  }
  
  #result_list thead th,
  #result_list tbody td {
    padding: 0.75rem;
  }
}

@media (max-width: 480px) {
  .change-list-header h1 {
    font-size: 1.25rem;
    flex-direction: column;
    text-align: center;
  }
  
  .change-list-header .material-icons {
    margin-right: 0;
    margin-bottom: 0.5rem;
  }
}

/* Loading States */
.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 200px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #e9ecef;
  border-top: 4px solid #34bdf2;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Animations */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in-up {
  animation: fadeInUp 0.6s ease-out;
}
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
  &rsaquo; {{ opts.app_config.verbose_name }}
  &rsaquo; {{ cl.opts.verbose_name_plural|capfirst }}
</div>
{% endblock %}

{% block content %}
<div class="change-list-container">
  <!-- Header -->
  <div class="change-list-header fade-in-up">
    <h1>
      {% if opts.app_label == 'accounts' %}
        <span class="material-icons">people</span>
      {% elif opts.app_label == 'appointments' %}
        <span class="material-icons">event</span>
      {% elif opts.app_label == 'services' %}
        <span class="material-icons">medical_services</span>
      {% elif opts.app_label == 'products' %}
        <span class="material-icons">inventory</span>
      {% elif opts.app_label == 'blog' %}
        <span class="material-icons">article</span>
      {% elif opts.app_label == 'testimonials' %}
        <span class="material-icons">rate_review</span>
      {% elif opts.app_label == 'notifications' %}
        <span class="material-icons">notifications</span>
      {% elif opts.app_label == 'surveys' %}
        <span class="material-icons">poll</span>
      {% elif opts.app_label == 'staff_chat' %}
        <span class="material-icons">chat</span>
      {% elif opts.app_label == 'analytics' %}
        <span class="material-icons">analytics</span>
      {% elif opts.app_label == 'gallery' %}
        <span class="material-icons">photo_library</span>
      {% elif opts.app_label == 'careers' %}
        <span class="material-icons">work</span>
      {% else %}
        <span class="material-icons">list</span>
      {% endif %}
      {{ title }}
    </h1>
    <p class="change-list-subtitle">{{ opts.app_config.verbose_name }} Management</p>
  </div>

  <!-- Add Link -->
  {% if has_add_permission %}
    <div class="add-link-container fade-in-up">
      <a href="{% url cl.opts|admin_urlname:'add' %}" class="addlink">
        {% blocktranslate with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktranslate %}
      </a>
    </div>
  {% endif %}

  <!-- Search -->
  {% if cl.search_fields %}
    <div class="search-filters-container fade-in-up">
      <form class="search-form" method="get">
        <input type="text" size="40" name="{{ search_var }}" value="{{ cl.query }}" id="searchbar" autofocus placeholder="{% blocktranslate %}Search {{ cl.opts.verbose_name_plural }}{% endblocktranslate %}">
        <div>
          {% for k, v in cl.params.items %}
            {% if k != search_var %}
              <input type="hidden" name="{{ k }}" value="{{ v }}">
            {% endif %}
          {% endfor %}
          <input type="submit" class="search-submit" value="{% translate 'Search' %}">
          {% if cl.query %}
            <a href="{% url cl.opts|admin_urlname:'changelist' %}" style="margin-left: 1rem; color: #6c757d; text-decoration: none;">{% translate 'Clear' %}</a>
          {% endif %}
        </div>
      </form>
    </div>
  {% endif %}

  <!-- Actions -->
  {% if action_form and actions_on_top and cl.show_admin_actions %}
    <div class="actions-container fade-in-up">
      <form method="post" class="actions">
        {% csrf_token %}
        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
          <label for="action-toggle" style="display: flex; align-items: center; font-weight: 500; color: #1e266f;">
            <input type="checkbox" id="action-toggle" class="action-select" style="margin-right: 0.5rem;">
            Select all
          </label>
          {{ action_form.action }}
          <button type="submit" class="action-button" name="index" value="{{ action_index|default:0 }}">
            <span class="material-icons">play_arrow</span>
            {% translate "Go" %}
          </button>
        </div>
        {% if cl.result_count %}
          <span class="action-counter" data-actions-icnt="{{ cl.result_count }}">
            0 of {{ cl.result_count }} selected
          </span>
        {% endif %}
      </form>
    </div>
  {% endif %}

  <!-- Results -->
  <div class="results-container fade-in-up">
    <div class="results-header">
      <h3 class="results-title">
        <span class="material-icons">list</span>
        {% if cl.result_count == 1 %}{{ cl.result_count }} {{ cl.opts.verbose_name }}{% else %}{{ cl.result_count }} {{ cl.opts.verbose_name_plural }}{% endif %}
      </h3>
      {% if cl.result_count %}
        <div class="results-count">
          {% if cl.full_result_count != cl.result_count %}
            {{ cl.result_count }} of {{ cl.full_result_count }}
          {% else %}
            {{ cl.result_count }} total
          {% endif %}
        </div>
      {% endif %}
    </div>

    {% if cl.result_count %}
      <div style="overflow-x: auto;">
        {% result_list cl %}
      </div>
      
      {% if cl.result_count and cl.show_full_result_count %}
        <p class="paginator-info" style="padding: 1rem 2rem; color: #6c757d; margin: 0; border-top: 1px solid #e9ecef;">
          {{ cl.result_count }}{% if cl.result_count == 1 %} {{ cl.opts.verbose_name }}{% else %} {{ cl.opts.verbose_name_plural }}{% endif %}
          {% if cl.full_result_count != cl.result_count %}
            ({% blocktranslate count counter=cl.full_result_count %}{{ counter }} total{% plural %}{{ counter }} total{% endblocktranslate %})
          {% endif %}
        </p>
      {% endif %}
    {% else %}
      <div class="empty-state">
        <span class="material-icons">inbox</span>
        <h3>No {{ cl.opts.verbose_name_plural|lower }} found</h3>
        <p>{% if cl.query %}No {{ cl.opts.verbose_name_plural|lower }} match your search criteria.{% else %}No {{ cl.opts.verbose_name_plural|lower }} have been added yet.{% endif %}</p>
      </div>
    {% endif %}
  </div>

  <!-- Pagination -->
  {% if cl.result_count and cl.can_show_all %}
    <div class="pagination">
      {% pagination cl %}
    </div>
  {% endif %}
</div>

<script>
// Enhanced admin functionality
document.addEventListener('DOMContentLoaded', function() {
  // Action checkbox functionality
  const actionToggle = document.getElementById('action-toggle');
  const actionCheckboxes = document.querySelectorAll('.action-checkbox');
  const actionCounter = document.querySelector('.action-counter');
  
  if (actionToggle && actionCheckboxes.length > 0) {
    actionToggle.addEventListener('change', function() {
      actionCheckboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
      });
      updateActionCounter();
    });
    
    actionCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', updateActionCounter);
    });
    
    function updateActionCounter() {
      const checkedCount = document.querySelectorAll('.action-checkbox:checked').length;
      const totalCount = actionCheckboxes.length;
      
      if (actionCounter) {
        actionCounter.textContent = `${checkedCount} of ${totalCount} selected`;
      }
      
      if (actionToggle) {
        actionToggle.checked = checkedCount === totalCount;
        actionToggle.indeterminate = checkedCount > 0 && checkedCount < totalCount;
      }
    }
    
    updateActionCounter();
  }
  
  // Add loading states to links
  const tableLinks = document.querySelectorAll('#result_list a');
  tableLinks.forEach(link => {
    link.addEventListener('click', function() {
      const loadingSpinner = document.createElement('span');
      loadingSpinner.className = 'loading';
      loadingSpinner.innerHTML = '<div class="spinner"></div>';
      this.appendChild(loadingSpinner);
    });
  });
  
  // Animate table rows
  const tableRows = document.querySelectorAll('#result_list tbody tr');
  tableRows.forEach((row, index) => {
    setTimeout(() => {
      row.style.animation = 'fadeInUp 0.6s ease-out';
    }, index * 50);
  });
});
</script>
{% endblock %}
